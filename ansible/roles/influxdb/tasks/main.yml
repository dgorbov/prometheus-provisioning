- block:
  - name: Add the InfluxData signing key
    apt_key:
      url: https://repos.influxdata.com/influxdb.key
      state: present

  - name: Add the InfluxData repository
    apt_repository:
      repo: "deb https://repos.influxdata.com/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} stable"
      state: present

  - name: Install InfluxDB
    apt:
      name: influxdb

  - name: Start the InfluxDB service
    systemd:
      name: influxdb
      enabled: yes
      state: started

  when: ansible_facts['distribution'] == 'Ubuntu' and ansible_facts['architecture'] == 'x86_64'
  become: yes